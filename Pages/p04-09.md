# ðŸ”° **STAGE 9 â€” Special Topics in Time Series**

---

## ðŸ”¸ **9.1 â€” Anomaly Detection**

---

### âœ… Why Important?

* Identify abnormal events (spikes, drops, shifts)
* Useful for fraud detection, system monitoring, unusual behavior

---

### âœ… Simple Z-Score Method:

```python
# Calculate rolling mean and std
rolling_mean = df['Sales'].rolling(window=30).mean()
rolling_std = df['Sales'].rolling(window=30).std()

# Calculate z-score
df['z_score'] = (df['Sales'] - rolling_mean) / rolling_std

# Mark anomalies (e.g., z > 3)
df['anomaly'] = df['z_score'].apply(lambda x: 1 if abs(x) > 3 else 0)

# Plot
plt.figure(figsize=(12,6))
plt.plot(df['Sales'], label='Sales')
plt.scatter(df[df['anomaly'] == 1].index, df[df['anomaly'] == 1]['Sales'], color='red', label='Anomaly')
plt.title('Anomaly Detection (Z-score)')
plt.legend()
plt.grid(True)
plt.show()
```

ðŸ‘‰ Very simple but works surprisingly well.

---

### âœ… Prophet also supports anomaly detection naturally.

* If forecast confidence interval is narrow and actual observation falls outside â†’ possible anomaly.

---

---

## ðŸ”¸ **9.2 â€” Causality Analysis (Granger Causality)**

---

### âœ… What is Granger Causality?

* If variable X helps predict future Y, we say **X Granger-causes Y**.
* It does **not** imply true causality, only predictive influence.

---

### âœ… Example:

```python
from statsmodels.tsa.stattools import grangercausalitytests

# Test if 'Ad_Spend' causes 'Sales'
grangercausalitytests(df_multivar[['Sales', 'Ad_Spend']], maxlag=5)
```

ðŸ‘‰ The test gives p-values at different lags.

* If p-value < 0.05 â†’ Granger-causality exists at that lag.

---

âœ… Use Case:

* Determine which features to include in multivariate forecasting.

---

---

## ðŸ”¸ **9.3 â€” Time Series Cross Validation**

---

### âœ… Problem with normal cross-validation:

* Time series is ordered â†’ we cannot randomly shuffle!

---

### âœ… Solution: Use **Rolling Forecast Origin** or **Expanding Window**:

```python
import numpy as np
from sklearn.model_selection import TimeSeriesSplit

tscv = TimeSeriesSplit(n_splits=5)

for train_index, test_index in tscv.split(df['Sales']):
    print("TRAIN:", train_index, "TEST:", test_index)
    
    train, test = df['Sales'].iloc[train_index], df['Sales'].iloc[test_index]
    
    # Here you can fit ARIMA or other models on 'train' and validate on 'test'
```

---

âœ… **Benefit:**

* More robust evaluation.
* Mimics real forecasting where only past data is available to predict future.

---

---

# ðŸ”° **You Now Know: FULL CYCLE of Time Series**

| Level              | Skill                                             |
| ------------------ | ------------------------------------------------- |
| âœ… **Foundations**  | Understanding time series structure               |
| âœ… **Stationarity** | Check & transform                                 |
| âœ… **Modeling**     | ARIMA, SARIMA, Holt-Winters, Prophet, VAR         |
| âœ… **Evaluation**   | MAE, RMSE, MAPE, Cross-validation                 |
| âœ… **Advanced**     | Anomaly detection, causality, multivariate models |

---

ðŸ‘‰ **Your task:**

* Try anomaly detection and Granger causality on your data.
* Practice rolling cross-validation.

---

# ðŸ”° **NEXT STAGE â€” FINAL STAGE**

âœ… **Stage 10 â€” Complete Real-World Case Study Project**

* âœ… End-to-end real data analysis
* âœ… Full pipeline: data prep â†’ modeling â†’ evaluation â†’ deployment-like results

---

